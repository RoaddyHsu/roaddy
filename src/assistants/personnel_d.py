"""
人員 D (美編專員) AI Agent
"""

from .base_assistant import BaseAssistant
from typing import Dict


class PersonnelDAssistant(BaseAssistant):
    """人員 D (美編專員) 專用助手 - 設計執行與製作"""

    # 工作流程類型
    WORKFLOW_DESIGN_EXECUTION = "design_execution"  # 設計執行
    WORKFLOW_PRESENTATION = "presentation"  # 簡報製作
    WORKFLOW_SOCIAL_GRAPHICS = "social_graphics"  # 社群圖文製作
    WORKFLOW_PRINT_PRODUCTION = "print_production"  # 印刷製作
    WORKFLOW_FILE_MANAGEMENT = "file_management"  # 檔案管理
    WORKFLOW_DESIGN_QA = "design_qa"  # 設計品質檢查

    def __init__(self):
        # 主系統提示詞
        system_prompt = """你是弘爺漢堡美編專員 (人員 D) 的專屬 AI 助手。

## 核心職責
- 設計執行與檔案製作
- 簡報設計與製作
- 社群圖文快速產出
- 印刷品製作與校對
- 檔案管理與版本控制
- 設計品質檢查

## 工作特性
- 執行效率與品質並重
- 需熟悉各種設計軟體與規格
- 重視細節與準確性
- 快速回應與彈性調整

## 技術能力
- 設計軟體: Photoshop, Illustrator, InDesign, Canva
- 簡報工具: PowerPoint, Keynote, Google Slides
- 檔案格式: AI, PSD, PDF, JPG, PNG, SVG
- 印刷知識: 出血、色彩模式、解析度、紙張

## 品牌規範
- 弘爺漢堡品牌視覺規範
- 色彩系統: 主色紅、輔色黃
- 字體系統: 指定中英文字體
- 檔案命名規則

## 協作助理
您可以調用以下專業助理協助工作：
- 簡報製作助理：提供簡報架構與內容建議
- 視覺設計助理：提供設計方向指引

根據用戶的需求，提供專業的設計執行與技術建議。"""

        super().__init__(
            assistant_type="personnel_d",
            system_prompt=system_prompt,
            use_anthropic=True,
        )

    def get_welcome_message(self) -> str:
        """獲取歡迎訊息"""
        return """
# 歡迎使用人員 D (美編專員) AI Agent 🖌️

我是弘爺漢堡美編專員的專屬 AI 助手！

## 📋 我能協助您

### 🎨 設計執行
**1️⃣ 設計執行指引**
設計製作流程與技術規格建議

**2️⃣ 設計品質檢查**
出檔前的完整檢查清單

### 📊 簡報製作
**3️⃣ 簡報製作**
快速產出專業簡報

### 📱 社群圖文
**4️⃣ 社群圖文製作**
快速製作社群貼文圖

### 🖨️ 印刷製作
**5️⃣ 印刷製作規範**
印刷品製作與規格建議

### 📁 檔案管理
**6️⃣ 檔案管理**
檔案命名、整理與版本控制

## 💡 快速啟動

**設計執行：**
- `/design` - 設計執行指引
- `/qa` - 設計品質檢查

**內容製作：**
- `/ppt` - 簡報製作
- `/social` - 社群圖文製作

**製作規範：**
- `/print` - 印刷製作規範
- `/file` - 檔案管理

**查看所有：**
- `/workflows` - 查看所有工作流程

或直接描述您的需求，我會提供專業建議！

準備好開始了嗎？
"""

    def get_help_message(self) -> str:
        """獲取幫助訊息"""
        return """
# 人員 D (美編專員) 助手使用指南

## 📋 支援的工作流程

### 1. 設計執行指引
**使用時機：** 接到設計任務需要執行
**輸入指令：** `/design`
**需要資訊：**
- 設計類型
- 設計規格
- 設計概念或參考
- 交件時程

**輸出內容：**
- 製作流程建議
- 軟體與工具選擇
- 尺寸與規格設定
- 設計元素建議
- 技術注意事項
- 時程規劃
- 檢查清單

---

### 2. 簡報製作
**使用時機：** 需要製作提案或報告簡報
**輸入指令：** `/ppt`
**需要資訊：**
- 簡報目的
- 目標聽眾
- 主要內容
- 頁數需求
- 時程

**輸出內容：**
- 簡報架構建議（頁面配置）
- 視覺風格建議
- 版面設計建議
  * 封面設計
  * 內頁模板
  * 資訊圖表
  * 結尾頁
- 設計技巧
- 動畫與轉場建議
- 製作時程規劃

---

### 3. 社群圖文製作
**使用時機：** 快速製作社群貼文圖
**輸入指令：** `/social`
**需要資訊：**
- 平台類型（FB/IG/LINE）
- 貼文主題
- 主要文字內容
- 圖片素材（有/無）
- 風格要求

**輸出內容：**
- 版面規格（尺寸/安全範圍）
- 排版建議（3 個版型）
- 文字處理技巧
  * 字體選擇
  * 大小層級
  * 顏色配置
- 視覺元素建議
- 製作工具建議（PS/Canva/線上工具）
- 快速製作技巧
- 匯出規格

---

### 4. 印刷製作規範
**使用時機：** 製作印刷品前確認規格
**輸入指令：** `/print`
**需要資訊：**
- 印刷品類型（海報/DM/名片/立牌）
- 尺寸大小
- 印刷方式
- 特殊工藝需求

**輸出內容：**
- 印前設定檢查
  * 文件尺寸與出血
  * 色彩模式（CMYK）
  * 解析度要求
  * 字體轉外框
- 印刷規格建議
  * 紙張選擇
  * 印刷方式
  * 特殊工藝（上光/燙金）
- 檔案輸出規範
- 打樣注意事項
- 驗收檢查重點
- 常見問題與解決

---

### 5. 檔案管理
**使用時機：** 整理設計檔案或建立管理系統
**輸入指令：** `/file`
**需要資訊：**
- 目前檔案狀況
- 管理問題
- 團隊規模
- 協作需求

**輸出內容：**
- 檔案命名規則
  * 專案命名
  * 版本控制
  * 日期格式
- 資料夾結構建議
- 檔案類型管理
  * 原始檔
  * 輸出檔
  * 素材檔
- 版本控制策略
- 備份機制
- 協作工具建議
- 雲端儲存建議

---

### 6. 設計品質檢查
**使用時機：** 設計完成準備出檔前
**輸入指令：** `/qa`
**需要資訊：**
- 設計類型
- 輸出用途
- 特殊要求

**輸出內容：**
- 完整檢查清單

  **基礎檢查：**
  □ 文件尺寸正確
  □ 出血設定正確（3mm）
  □ 解析度符合要求（印刷 300dpi / 數位 72-150dpi）
  □ 色彩模式正確（印刷 CMYK / 數位 RGB）

  **內容檢查：**
  □ 文字無錯別字
  □ 資訊完整無遺漏
  □ 聯絡資訊正確
  □ Logo 與品牌元素正確

  **技術檢查：**
  □ 字體已轉外框或附加字體檔
  □ 圖片已嵌入或連結完整
  □ 無多餘圖層或物件
  □ 圖層命名清楚

  **視覺檢查：**
  □ 對齊與間距一致
  □ 色彩與品牌規範一致
  □ 視覺層級清楚
  □ 留白適當

  **輸出檢查：**
  □ 檔案格式正確
  □ 檔案命名符合規則
  □ 檔案大小適當

- 分類別檢查重點
- 常見錯誤提醒
- 修正建議

---

## 🎯 使用技巧

### 快速指令
- `/workflows` - 查看所有工作流程
- `/design` - 設計執行指引
- `/ppt` - 簡報製作
- `/social` - 社群圖文製作
- `/print` - 印刷製作規範
- `/file` - 檔案管理
- `/qa` - 設計品質檢查

### 自然對話
您也可以直接描述需求，例如：
- "我要做一張 IG 貼文"
- "幫我檢查這個印刷檔"
- "簡報怎麼排版比較好？"
- "檔案要怎麼命名？"

## 💡 最佳實踐

1. **事前確認** - 開始製作前先確認規格與需求
2. **遵循規範** - 嚴格遵守品牌視覺規範
3. **注重細節** - 文字、尺寸、色彩都要仔細檢查
4. **版本控制** - 養成良好的檔案命名與備份習慣
5. **出檔前檢查** - 使用檢查清單避免錯誤

需要開始使用嗎？輸入 `/workflows` 查看所有工作流程！
"""

    def get_workflow_prompt(self, workflow_type: str, context: Dict = None) -> str:
        """
        獲取特定工作流程的提示詞

        Args:
            workflow_type: 工作流程類型
            context: 上下文資訊

        Returns:
            工作流程提示詞
        """
        workflows = {
            self.WORKFLOW_DESIGN_EXECUTION: self._get_design_execution_prompt,
            self.WORKFLOW_PRESENTATION: self._get_presentation_prompt,
            self.WORKFLOW_SOCIAL_GRAPHICS: self._get_social_graphics_prompt,
            self.WORKFLOW_PRINT_PRODUCTION: self._get_print_production_prompt,
            self.WORKFLOW_FILE_MANAGEMENT: self._get_file_management_prompt,
            self.WORKFLOW_DESIGN_QA: self._get_design_qa_prompt,
        }

        prompt_func = workflows.get(workflow_type)
        if prompt_func:
            return prompt_func(context or {})
        return ""

    def _get_design_execution_prompt(self, context: Dict) -> str:
        """設計執行指引提示詞"""
        return """請提供設計執行指引。

**設計執行流程：**

**1. 需求確認**
- 了解設計目的
- 確認規格與限制
- 釐清交件時程

**2. 前置作業**
- 軟體與工具選擇
- 文件設定
- 素材準備

**3. 設計製作**
- 版面配置
- 視覺元素製作
- 細節調整

**4. 檢查與輸出**
- 品質檢查
- 檔案輸出
- 備份歸檔

請根據以下資訊提供執行指引：

【請在此描述您的設計需求】
- 設計類型：
  □ 社群圖文
  □ 印刷品（海報/DM/立牌）
  □ 數位廣告
  □ 簡報
  □ 包裝
  □ 其他：
- 規格需求：
  - 尺寸：
  - 色彩模式：
  - 解析度：
- 設計概念/參考：
- 可用素材：
- 交件時程：
- 特殊需求：

我將為您提供：
✅ 完整製作流程
  **前置作業：**
  - 軟體選擇建議
  - 文件設定（尺寸/色彩/解析度）
  - 素材準備清單

  **設計製作：**
  - 版面規劃建議
  - 視覺元素製作步驟
  - 設計技巧提示
  - 圖層管理建議

  **檢查與輸出：**
  - 品質檢查清單
  - 輸出格式與設定
  - 檔案命名規則

✅ 技術注意事項
✅ 時程規劃建議
✅ 常見問題處理
✅ 效率提升技巧
"""

    def _get_presentation_prompt(self, context: Dict) -> str:
        """簡報製作提示詞"""
        return """請幫我規劃簡報製作。

**簡報製作原則：**

**1. 架構規劃**
- 開場（封面/大綱）
- 內容（分段說明）
- 結尾（總結/CTA）

**2. 視覺設計**
- 一致性風格
- 清晰的視覺層級
- 適當的留白

**3. 資訊呈現**
- 重點突出
- 圖表化呈現
- 避免過度擁擠

**4. 技術細節**
- 字體大小適中
- 色彩對比清楚
- 動畫簡約不花俏

請根據以下資訊規劃簡報：

【請在此描述您的簡報需求】
- 簡報目的：
  □ 提案簡報
  □ 成果報告
  □ 教育訓練
  □ 產品介紹
  □ 其他：
- 目標聽眾：
- 簡報時間：
- 主要內容大綱：
- 頁數需求：
- 視覺風格偏好：
- 交件時程：
- 特殊需求：

我將為您提供：
✅ 簡報架構建議
  - 完整頁面配置（封面到結尾）
  - 各頁面主題與重點
  - 建議頁數與節奏

✅ 視覺設計規劃
  **封面設計：**
  - 版面配置建議
  - 視覺元素
  - 資訊層級

  **內頁模板：**
  - 標題頁
  - 內容頁（文字/圖文/圖表）
  - 分隔頁
  - 總結頁

  **視覺統一：**
  - 色彩計畫
  - 字體系統
  - 圖示風格
  - 版面格線

✅ 資訊圖表建議
  - 圖表類型選擇
  - 數據視覺化技巧
  - 重點標示方式

✅ 設計技巧
  - 排版技巧
  - 對比與強調
  - 動畫與轉場建議

✅ 製作時程規劃
✅ 簡報演示技巧
"""

    def _get_social_graphics_prompt(self, context: Dict) -> str:
        """社群圖文製作提示詞"""
        return """請幫我製作社群圖文。

**社群圖文製作要點：**

**1. 平台規格**
- FB: 1200x630 / 1080x1080
- IG: 1080x1080 / 1080x1350 / 1080x1920 (限動)
- LINE: 1040x1040

**2. 視覺設計**
- 主視覺吸睛
- 文字清晰易讀
- 品牌元素明確

**3. 製作效率**
- 使用模板
- 建立元素庫
- 批次製作

請根據以下資訊製作社群圖文：

【請在此描述您的社群圖文需求】
- 發布平台：（FB/IG/LINE/Threads）
- 貼文類型：
  □ 產品介紹
  □ 優惠促銷
  □ 活動宣傳
  □ 品牌故事
  □ 節慶祝賀
  □ 互動問答
  □ 其他：
- 主要文字內容：
- 次要資訊：
- 可用圖片素材：（有/無）
- 視覺風格：
- 緊急程度：
- 特殊需求：

我將為您提供：
✅ 版面規格
  - 尺寸設定（含安全範圍）
  - 文件設定建議
  - 解析度要求

✅ 排版建議（3 個版型）
  **版型 A：圖片主導型**
  - 配置說明
  - 文字處理
  - 適用情境

  **版型 B：文字主導型**
  - 配置說明
  - 視覺元素
  - 適用情境

  **版型 C：平衡型**
  - 配置說明
  - 圖文整合
  - 適用情境

✅ 文字處理技巧
  - 字體選擇（中英文）
  - 大小層級（標題/內文/說明）
  - 顏色配置
  - 可讀性提升技巧

✅ 視覺元素建議
  - 背景處理
  - 裝飾元素
  - 品牌元素擺放
  - 色彩搭配

✅ 製作工具建議
  - Photoshop（高品質/客製化）
  - Canva（快速/模板豐富）
  - 線上工具推薦

✅ 快速製作技巧
✅ 匯出規格與設定
"""

    def _get_print_production_prompt(self, context: Dict) -> str:
        """印刷製作規範提示詞"""
        return """請提供印刷製作規範建議。

**印刷製作關鍵：**

**1. 印前設定**
- 文件尺寸（成品尺寸 + 出血）
- 色彩模式（CMYK）
- 解析度（300dpi）
- 字體處理（轉外框）

**2. 印刷規格**
- 紙張選擇
- 印刷方式
- 特殊工藝

**3. 檔案輸出**
- 輸出格式（PDF/AI）
- 檔案檢查
- 與廠商確認

請根據以下資訊提供印刷製作建議：

【請在此描述您的印刷需求】
- 印刷品類型：
  □ 海報/大圖輸出
  □ DM/傳單
  □ 名片
  □ 立牌/展架
  □ 貼紙
  □ 包裝
  □ 其他：
- 成品尺寸：
- 數量：
- 預算範圍：
- 交件時程：
- 特殊需求：

我將為您提供：
✅ 印前設定檢查清單
  **文件設定：**
  □ 文件尺寸 = 成品尺寸 + 出血（單邊 3mm）
  □ 色彩模式設為 CMYK
  □ 解析度 300dpi（大圖可降至 150dpi）
  □ 字體已轉外框或附加字體檔
  □ 圖片已嵌入或連結完整
  □ 黑色文字設為 C0 M0 Y0 K100

  **內容檢查：**
  □ 文字內容無誤
  □ 重要資訊在安全範圍內
  □ 色彩在印刷色域內
  □ 底色延伸至出血線

✅ 印刷規格建議
  **紙張選擇：**
  - 材質建議（銅版紙/模造紙/特殊紙）
  - 磅數建議
  - 成本比較

  **印刷方式：**
  - 數位印刷 vs 平版印刷
  - 適用情境與數量
  - 成本差異

  **特殊工藝：**
  - 上光（亮/霧膜）
  - 燙金/燙銀
  - 軋型/打凸
  - 效果與成本

✅ 檔案輸出規範
  - 輸出格式（PDF-X1a / AI）
  - 檔案命名
  - 輸出設定

✅ 打樣與驗收
  - 打樣注意事項
  - 色彩校對
  - 驗收檢查重點

✅ 與廠商溝通重點
✅ 常見問題與解決
✅ 成本優化建議
"""

    def _get_file_management_prompt(self, context: Dict) -> str:
        """檔案管理提示詞"""
        return """請幫我規劃檔案管理系統。

**檔案管理原則：**

**1. 命名規則**
- 清楚易懂
- 包含關鍵資訊
- 便於搜尋

**2. 資料夾結構**
- 邏輯分類
- 層級適當
- 易於存取

**3. 版本控制**
- 版本編號
- 修改記錄
- 最終版標示

**4. 備份機制**
- 定期備份
- 多地備份
- 雲端同步

請根據以下資訊提供檔案管理建議：

【請在此描述您的檔案管理需求】
- 目前狀況：
- 主要問題：
  □ 檔案難找
  □ 版本混亂
  □ 命名不一致
  □ 容量不足
  □ 其他：
- 團隊規模：
- 協作需求：
- 特殊需求：

我將為您提供：
✅ 檔案命名規則
  **基本格式：**
  ```
  [日期]_[專案]_[類型]_[版本]
  20250124_HongyeBurger_Poster_v1
  ```

  **日期格式：** YYYYMMDD
  **專案代碼：** 統一命名（如：HYB_Spring2025）
  **類型代碼：**
  - Design（設計稿）
  - Final（最終檔）
  - Source（原始檔）
  - Export（輸出檔）
  **版本編號：** v1, v2, v3... / Final

✅ 資料夾結構建議
  ```
  專案資料夾/
  ├── 01_Brief與參考/
  ├── 02_素材/
  │   ├── 照片/
  │   ├── Logo與品牌元素/
  │   └── 其他素材/
  ├── 03_設計檔/
  │   ├── 原始檔（PSD/AI）/
  │   └── 版本記錄/
  ├── 04_輸出檔/
  │   ├── 印刷用/
  │   ├── 數位用/
  │   └── 簡報用/
  └── 05_最終交件/
  ```

✅ 版本控制策略
  - 版本編號規則
  - 修改記錄方式
  - 最終版確認流程

✅ 檔案類型管理
  **原始檔：**
  - PSD/AI/INDD（保留圖層）
  - 定期備份

  **輸出檔：**
  - PDF（印刷用：PDF-X1a）
  - JPG/PNG（數位用：RGB）
  - 依用途分類存放

  **素材檔：**
  - 照片（原始大圖）
  - Logo/品牌元素
  - 字體檔

✅ 備份機制
  - 本機備份（外接硬碟）
  - 雲端備份（Google Drive/Dropbox）
  - 備份頻率建議
  - 備份檢查清單

✅ 協作工具建議
  - Dropbox/Google Drive（檔案同步）
  - Notion/Asana（專案管理）
  - Frame.io（設計稿審核）

✅ 定期維護
  - 每月整理
  - 舊檔歸檔
  - 容量管理
"""

    def _get_design_qa_prompt(self, context: Dict) -> str:
        """設計品質檢查提示詞"""
        return """請幫我進行設計品質檢查。

**設計品質檢查架構：**

**1. 基礎技術檢查**
- 文件設定
- 檔案規格
- 輸出格式

**2. 內容正確性**
- 文字內容
- 資訊完整性
- 品牌元素

**3. 視覺品質**
- 視覺層級
- 對齊與間距
- 色彩與風格

**4. 輸出準備**
- 檔案命名
- 輸出設定
- 交件內容

請根據以下資訊提供檢查清單：

【請在此描述您的設計檢查需求】
- 設計類型：
  □ 社群圖文
  □ 印刷品
  □ 數位廣告
  □ 簡報
  □ 其他：
- 輸出用途：
- 特殊要求：

我將為您提供：
✅ 完整檢查清單

**一、基礎技術檢查**

□ **文件設定**
  - 尺寸正確（成品尺寸 + 出血）
  - 色彩模式正確（印刷 CMYK / 數位 RGB）
  - 解析度符合（印刷 300dpi / 數位 72-150dpi）
  - 出血設定正確（3mm）

□ **圖層管理**
  - 圖層命名清楚
  - 無多餘隱藏圖層
  - 圖層組織合理

□ **字體處理**
  - 字體已轉外框（印刷）
  - 或附加字體檔案
  - 無遺失字體

□ **圖片素材**
  - 圖片已嵌入或連結完整
  - 圖片解析度足夠
  - 無低解析度警告

**二、內容正確性檢查**

□ **文字內容**
  - 無錯別字
  - 標點符號正確
  - 數字與日期正確
  - 英文大小寫正確

□ **資訊完整性**
  - 必要資訊完整（地址/電話/網址/時間）
  - QR Code 可掃描且正確
  - 優惠內容與條款清楚

□ **品牌元素**
  - Logo 正確且清晰
  - Logo 使用符合規範
  - 品牌色使用正確

**三、視覺品質檢查**

□ **視覺層級**
  - 主標清楚突出
  - 資訊層級分明
  - 重點一目了然

□ **對齊與間距**
  - 元素對齊整齊
  - 間距一致適當
  - 版面平衡協調

□ **色彩與風格**
  - 色彩搭配和諧
  - 符合品牌規範
  - 風格一致

□ **留白與呼吸**
  - 版面不擁擠
  - 留白適當
  - 視覺舒適

□ **可讀性**
  - 文字大小適中
  - 色彩對比清楚
  - 背景不影響閱讀

**四、輸出準備檢查**

□ **印刷專用額外檢查**
  - 重要資訊在安全範圍內
  - 底色延伸至出血線
  - 黑色文字設為單黑（K100）
  - 細線粗度足夠（0.3pt 以上）

□ **數位專用額外檢查**
  - 檔案大小適當（不過大）
  - 色彩鮮豔（RGB 模式）
  - 適合螢幕顯示

□ **檔案輸出**
  - 輸出格式正確
  - 檔案命名符合規則
  - 壓縮設定適當

□ **交件內容**
  - 原始檔案
  - 輸出檔案
  - 使用字體（如需要）
  - 素材來源（如需要）

✅ 分類別專用檢查
✅ 常見錯誤提醒
✅ 修正優先順序建議
"""

    def start_workflow(self, workflow_type: str, user_input: str = "") -> str:
        """
        啟動特定工作流程

        Args:
            workflow_type: 工作流程類型
            user_input: 用戶輸入

        Returns:
            助手回應
        """
        # 獲取工作流程提示詞
        workflow_prompt = self.get_workflow_prompt(workflow_type)

        if not workflow_prompt:
            return "抱歉，不支援此工作流程。請輸入 /workflows 查看所有可用的工作流程。"

        # 組合完整訊息
        full_message = f"{workflow_prompt}\n\n{user_input}" if user_input else workflow_prompt

        # 使用 chat 方法處理
        return self.chat(full_message)

    def list_workflows(self) -> str:
        """列出所有可用的工作流程"""
        return """
# 人員 D (美編專員) 可用工作流程

## 🎨 設計執行類
1. **設計執行指引** (`/design`)
   - 設計製作流程建議
   - 技術規格指引

2. **設計品質檢查** (`/qa`)
   - 完整檢查清單
   - 出檔前檢查

## 📊 內容製作類
3. **簡報製作** (`/ppt`)
   - 簡報架構與設計
   - 視覺風格建議

4. **社群圖文製作** (`/social`)
   - 快速製作社群貼文
   - 版面與技巧建議

## 🖨️ 製作規範類
5. **印刷製作規範** (`/print`)
   - 印刷規格與注意事項
   - 檔案輸出規範

6. **檔案管理** (`/file`)
   - 檔案命名與整理
   - 版本控制機制

---

**快速使用：** 直接輸入指令（如 `/design`）或描述您的需求！
"""
