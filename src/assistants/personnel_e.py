"""
人員 E (團購PM) AI Agent
"""

from .base_assistant import BaseAssistant
from typing import Dict, Optional


class PersonnelEAssistant(BaseAssistant):
    """人員 E (團購PM) 專用助手 - 團購專案管理"""

    # 工作流程類型
    WORKFLOW_CAMPAIGN_PLANNING = "campaign_planning"  # 團購企劃
    WORKFLOW_VENDOR_MANAGEMENT = "vendor_management"  # 廠商管理
    WORKFLOW_LOGISTICS = "logistics"  # 物流配送
    WORKFLOW_CUSTOMER_SERVICE = "customer_service"  # 客服處理
    WORKFLOW_PERFORMANCE_TRACKING = "performance_tracking"  # 成效追蹤
    WORKFLOW_CRISIS_HANDLING = "crisis_handling"  # 危機處理

    def __init__(self):
        # 主系統提示詞
        system_prompt = """你是弘爺漢堡團購專案經理 (人員 E) 的專屬 AI 助手。

## 核心職責
- 團購活動企劃與執行
- 廠商/團媽溝通協調
- 物流配送規劃管理
- 客服問題處理
- 銷售成效追蹤分析
- 危機處理與應變

## 工作特性
- 需同時管理多個團購專案
- 即時回應與問題處理
- 重視客戶滿意度
- 數據驅動決策與優化

## 團購模式
- B2B（企業/機關團購）
- B2C（社群/團媽團購）
- 線上團購平台
- 實體團購活動

## 品牌特色
- 弘爺漢堡: 現做現煎、台式口味、平價美味
- 團購優勢: 新鮮製作、客製化、大量優惠
- 服務特色: 快速回應、彈性配合

## 可用框架工具
- 專案管理框架
- 客戶服務 SOP
- 數據分析框架
- 危機處理流程

## 協作助理
您可以調用以下專業助理協助工作：
- 專案管理助理：協助時程與資源規劃
- 數據分析助理：提供成效分析與洞察
- 文案創作助理：團購文案與素材

根據用戶的需求，提供專業的團購專案管理建議。"""

        super().__init__(
            assistant_type="personnel_e",
            system_prompt=system_prompt,
            use_anthropic=True,
        )

    def get_welcome_message(self) -> str:
        """獲取歡迎訊息"""
        return """
# 歡迎使用人員 E (團購PM) AI Agent 📦

我是弘爺漢堡團購專案經理的專屬 AI 助手！

## 📋 我能協助您

### 📅 專案規劃
**1️⃣ 團購企劃**
完整團購活動規劃與執行方案

**2️⃣ 廠商管理**
團媽/企業客戶溝通協調

### 🚚 執行管理
**3️⃣ 物流配送**
配送規劃與流程管理

**4️⃣ 客服處理**
客戶問題快速處理方案

### 📊 成效優化
**5️⃣ 成效追蹤**
銷售數據分析與優化建議

**6️⃣ 危機處理**
團購危機應對與解決

## 💡 快速啟動

**專案規劃：**
- `/plan` - 團購企劃
- `/vendor` - 廠商管理

**執行管理：**
- `/logistics` - 物流配送
- `/cs` - 客服處理

**成效優化：**
- `/track` - 成效追蹤
- `/crisis` - 危機處理

**查看所有：**
- `/workflows` - 查看所有工作流程

或直接描述您的需求，我會提供專業建議！

準備好開始了嗎？
"""

    def get_help_message(self) -> str:
        """獲取幫助訊息"""
        return """
# 人員 E (團購PM) 助手使用指南

## 📋 支援的工作流程

### 1. 團購企劃
**使用時機：** 規劃新的團購活動
**輸入指令：** `/plan`
**需要資訊：**
- 團購類型（B2B/B2C/平台/實體）
- 產品項目
- 目標業績
- 預計期間

**輸出內容：**
- 完整活動企劃
  * 活動架構
  * 產品組合建議
  * 價格策略
  * 優惠方案
- 推廣策略
  * 目標客群
  * 推廣管道
  * 文案與素材
- 執行時程表
- 資源需求清單
- 風險評估
- 成效預估

---

### 2. 廠商管理
**使用時機：** 開發或維護團媽/企業客戶
**輸入指令：** `/vendor`
**需要資訊：**
- 廠商類型（新開發/既有客戶）
- 合作模式
- 目前狀況或問題

**輸出內容：**
- 廠商開發策略
  * 篩選標準
  * 接觸方式
  * 提案內容
- 合作方案設計
  * 價格與折扣
  * 分潤機制
  * 配送方式
- 溝通腳本範本
- 關係維護策略
- 問題處理建議
- 合約重點提示

---

### 3. 物流配送
**使用時機：** 規劃團購配送或解決配送問題
**輸入指令：** `/logistics`
**需要資訊：**
- 訂單規模
- 配送地點
- 配送時間要求
- 特殊需求

**輸出內容：**
- 配送方案規劃
  * 配送方式選擇（集中點/分點/宅配）
  * 路線規劃
  * 時程安排
- 包裝規格建議
- 保溫/保鮮方案
- 配送 SOP
  * 出貨準備
  * 配送流程
  * 交接確認
- 成本評估
- 異常處理流程
- 品質控管要點

---

### 4. 客服處理
**使用時機：** 處理客戶問題或建立客服 SOP
**輸入指令：** `/cs`
**需要資訊：**
- 問題類型
- 問題描述
- 緊急程度
- 客戶資訊

**輸出內容：**
- 問題分析與建議
- 回應範本（3 種情境）
  * 一般查詢
  * 客訴處理
  * 緊急狀況
- 處理流程 SOP
- 補償方案建議
- 預防措施
- 常見問題 FAQ
- 客服話術技巧
- 升級處理機制

---

### 5. 成效追蹤
**使用時機：** 分析團購成效或優化策略
**輸入指令：** `/track`
**需要資訊：**
- 活動資訊
- 銷售數據
- 分析期間
- 想了解的重點

**輸出內容：**
- 數據分析報告
  * 銷售表現
    - 總業績
    - 客單價
    - 轉換率
  * 產品分析
    - 熱銷/滯銷商品
    - 組合效益
  * 客戶分析
    - 客群分佈
    - 回購率
    - 滿意度
  * 管道分析
    - 各管道成效
    - 成本效益
- 關鍵洞察
- 優化建議（分優先級）
- 下次活動建議
- KPI 設定建議

---

### 6. 危機處理
**使用時機：** 面對團購危機或重大問題
**輸入指令：** `/crisis`
**需要資訊：**
- 危機類型
- 事件描述
- 影響範圍
- 目前處理狀況

**輸出內容：**
- 危機等級評估
- 立即行動建議（1 小時內）
- 溝通策略
  * 對客戶溝通
  * 對廠商溝通
  * 內部溝通
- 補償方案（3 個層級）
- 危機處理 SOP
- 後續追蹤計畫
- 預防機制建議
- 案例記錄建議

---

## 🎯 使用技巧

### 快速指令
- `/workflows` - 查看所有工作流程
- `/plan` - 團購企劃
- `/vendor` - 廠商管理
- `/logistics` - 物流配送
- `/cs` - 客服處理
- `/track` - 成效追蹤
- `/crisis` - 危機處理

### 自然對話
您也可以直接描述需求，例如：
- "我要規劃中秋節團購"
- "有個團媽想合作，怎麼談？"
- "100 份漢堡怎麼配送？"
- "客戶說漢堡冷掉了，怎麼處理？"

## 💡 最佳實踐

1. **事前規劃** - 活動前完整規劃避免臨時問題
2. **清楚溝通** - 與廠商/客戶溝通清楚避免誤解
3. **品質控管** - 每個環節都要確保品質
4. **快速回應** - 問題要即時處理避免擴大
5. **數據追蹤** - 記錄數據持續優化

需要開始使用嗎？輸入 `/workflows` 查看所有工作流程！
"""

    def get_workflow_prompt(self, workflow_type: str, context: Dict = None) -> str:
        """
        獲取特定工作流程的提示詞

        Args:
            workflow_type: 工作流程類型
            context: 上下文資訊

        Returns:
            工作流程提示詞
        """
        workflows = {
            self.WORKFLOW_CAMPAIGN_PLANNING: self._get_campaign_planning_prompt,
            self.WORKFLOW_VENDOR_MANAGEMENT: self._get_vendor_management_prompt,
            self.WORKFLOW_LOGISTICS: self._get_logistics_prompt,
            self.WORKFLOW_CUSTOMER_SERVICE: self._get_customer_service_prompt,
            self.WORKFLOW_PERFORMANCE_TRACKING: self._get_performance_tracking_prompt,
            self.WORKFLOW_CRISIS_HANDLING: self._get_crisis_handling_prompt,
        }

        prompt_func = workflows.get(workflow_type)
        if prompt_func:
            return prompt_func(context or {})
        return ""

    def _get_campaign_planning_prompt(self, context: Dict) -> str:
        """團購企劃提示詞"""
        return """請幫我規劃團購活動。

**團購企劃架構：**

**1. 活動定位**
- 團購類型
- 目標客群
- 活動目標

**2. 產品策略**
- 產品組合
- 價格策略
- 優惠方案

**3. 推廣策略**
- 推廣管道
- 文案與素材
- 話題操作

**4. 執行規劃**
- 時程規劃
- 資源配置
- 風險管理

請根據以下資訊規劃團購活動：

【請在此描述您的團購需求】
- 團購類型：
  □ B2B 企業團購（公司行號/機關學校）
  □ B2C 社群團購（團媽/社團）
  □ 線上團購平台
  □ 實體團購活動（市集/展售）
  □ 其他：
- 產品項目：
- 活動期間：
- 目標業績：
- 目標客群：
- 可用資源：
- 特殊限制：

我將為您提供：
✅ 完整活動企劃

  **活動架構：**
  - 活動主題與訴求
  - 目標設定（業績/客戶數/訂單量）
  - 活動亮點設計

  **產品組合建議：**
  - 主力產品
  - 組合套餐（3-5 種）
  - 加購商品
  - 限量/獨家商品

  **價格策略：**
  - 定價策略
  - 折扣結構（階梯式/滿額）
  - 早鳥/團購優惠
  - 利潤分析

  **優惠方案：**
  - 數量優惠
  - 首購優惠
  - 推薦獎勵
  - VIP 方案

✅ 推廣策略
  - 目標客群分析
  - 推廣管道建議（線上/線下）
  - 文案與素材需求
  - 話題操作建議
  - KOL/團媽合作策略

✅ 執行時程表
  - 前置準備（2-4 週）
  - 預購期（1-2 週）
  - 製作配送（1-3 天）
  - 售後服務

✅ 資源需求清單
  - 人力配置
  - 物料準備
  - 系統工具
  - 預算配置

✅ 風險評估與應對
  - 潛在風險
  - 預防措施
  - 應變計畫

✅ 成效預估
  - 業績預估
  - 訂單預估
  - 利潤預估
"""

    def _get_vendor_management_prompt(self, context: Dict) -> str:
        """廠商管理提示詞"""
        return """請幫我規劃廠商管理策略。

**廠商管理重點：**

**1. 廠商開發**
- 篩選標準
- 接觸策略
- 提案內容

**2. 合作方案**
- 價格與折扣
- 分潤機制
- 權利義務

**3. 關係維護**
- 定期聯繫
- 優惠政策
- 活動支援

**4. 問題處理**
- 衝突解決
- 績效管理
- 退場機制

請根據以下資訊提供廠商管理建議：

【請在此描述您的廠商管理需求】
- 廠商類型：
  □ 團媽（社群團購主）
  □ 企業採購（HR/總務）
  □ 團購平台
  □ 實體通路（超市/市集）
  □ 其他：
- 目前狀況：
  □ 新廠商開發
  □ 既有廠商維護
  □ 問題廠商處理
- 合作模式：
- 目標與期待：
- 遇到的挑戰：

我將為您提供：
✅ 廠商開發策略（新客戶）

  **篩選標準：**
  - 受眾匹配度（粉絲數/客群/活躍度）
  - 信譽與評價
  - 合作意願
  - 執行能力

  **接觸方式：**
  - 管道選擇（社群/電話/實體）
  - 接觸腳本
  - 破冰話題
  - 價值主張

  **提案內容：**
  - 品牌介紹
  - 產品優勢
  - 合作方案（3 個層級）
  - 成功案例
  - 支援項目

✅ 合作方案設計

  **方案 A - 基礎合作**
  - 採購折扣
  - 最低訂購量
  - 配送方式
  - 適合對象

  **方案 B - 進階合作**
  - 更優折扣
  - 客製化服務
  - 行銷支援
  - 適合對象

  **方案 C - 深度合作**
  - VIP 折扣
  - 獨家商品
  - 聯合行銷
  - 適合對象

  **分潤機制：**
  - 基本抽成
  - 業績獎金
  - 推薦獎勵

✅ 溝通腳本範本
  - 初次接觸
  - 提案說明
  - 議價協商
  - 成交確認
  - 定期關懷

✅ 關係維護策略
  - 分級管理（VIP/一般/觀察）
  - 定期聯繫頻率
  - 專屬優惠
  - 教育訓練
  - 活動支援

✅ 問題處理建議
  - 常見問題與解決
  - 衝突處理原則
  - 績效未達標處理
  - 退場機制

✅ 管理工具建議
  - CRM 系統
  - 訂單管理
  - 數據追蹤
"""

    def _get_logistics_prompt(self, context: Dict) -> str:
        """物流配送提示詞"""
        return """請幫我規劃物流配送方案。

**物流配送規劃重點：**

**1. 配送方式選擇**
- 集中點取貨
- 分點配送
- 宅配到府

**2. 流程規劃**
- 訂單確認
- 備貨出貨
- 配送追蹤
- 交接確認

**3. 品質控管**
- 保溫保鮮
- 包裝防護
- 時效控管

**4. 成本管理**
- 配送成本
- 人力配置
- 效率優化

請根據以下資訊規劃物流配送：

【請在此描述您的配送需求】
- 訂單規模：
  - 總訂單數：
  - 總數量：
  - 單筆訂單平均量：
- 配送範圍：
  □ 同一地點集中取貨
  □ 同區域多點配送
  □ 跨區域配送
  □ 全台配送
- 配送時間：
  - 期望配送日期：
  - 可配送時段：
- 產品特性：
  - 易碎/需保溫/需冷藏
- 預算範圍：
- 特殊需求：

我將為您提供：
✅ 配送方案規劃

  **方案比較：**

  **方案 A - 集中點取貨**
  - 適用情境
  - 流程說明
  - 成本評估
  - 優缺點

  **方案 B - 分點配送**
  - 適用情境
  - 路線規劃
  - 成本評估
  - 優缺點

  **方案 C - 宅配到府**
  - 適用情境
  - 合作物流
  - 成本評估
  - 優缺點

  **推薦方案：** [根據您的需求推薦]

✅ 詳細執行計畫

  **時程規劃：**
  - D-2: 訂單確認與彙整
  - D-1: 備料與製作
  - D-Day: 包裝與配送
  - D+1: 售後追蹤

  **配送流程 SOP：**
  1. 訂單確認（核對數量/地址/聯絡人）
  2. 備貨準備（製作/包裝/分類）
  3. 出貨前檢查（數量/品質/包裝）
  4. 配送執行（路線/時間/聯繫）
  5. 交接確認（簽收/拍照/回報）
  6. 售後追蹤（滿意度/問題處理）

✅ 包裝規格建議
  - 外箱規格
  - 內襯保護
  - 保溫材料（保溫袋/保冷劑）
  - 標示標籤
  - 封箱方式

✅ 品質控管要點
  - 溫度控管（製作到交付全程）
  - 時效控管（製作完成到交付不超過__小時）
  - 外觀檢查
  - 數量確認
  - 交付確認

✅ 異常處理流程
  - 客戶臨時異動（地址/時間/數量）
  - 配送延遲
  - 產品損壞
  - 漏單/錯單
  - 客訴處理

✅ 成本評估
  - 包材成本
  - 運輸成本（油資/過路費/停車費）
  - 人力成本
  - 總成本與單位成本

✅ 資源需求
  - 人力配置
  - 車輛需求
  - 保溫設備
  - 工具清單
"""

    def _get_customer_service_prompt(self, context: Dict) -> str:
        """客服處理提示詞"""
        return """請幫我處理客戶服務問題。

**客服處理原則：**

**1. 快速回應**
- 即時接收問題
- 快速初步回應
- 明確處理時程

**2. 同理溝通**
- 理解客戶感受
- 真誠道歉
- 清楚說明

**3. 有效解決**
- 找出問題根源
- 提供解決方案
- 追蹤確認結果

**4. 預防改善**
- 記錄問題
- 分析原因
- 改善流程

請根據以下資訊提供客服處理建議：

【請在此描述客服狀況】
- 問題類型：
  □ 一般查詢（訂單/配送/產品）
  □ 客訴（品質/服務/配送）
  □ 緊急狀況（食安/嚴重客訴）
  □ 其他：
- 問題描述：
- 客戶資訊：
  - 訂單資訊：
  - 客戶情緒：（平靜/不滿/憤怒）
- 緊急程度：（低/中/高）
- 已採取行動：

我將為您提供：
✅ 問題分析
  - 問題分類
  - 嚴重程度評估
  - 影響範圍
  - 根本原因

✅ 處理建議

  **立即行動（1 小時內）：**
  - 第一時間回應
  - 表達同理與歉意
  - 說明處理時程

  **解決方案：**
  - 方案 A（輕度）
  - 方案 B（中度）
  - 方案 C（重度）
  - 推薦方案

  **後續追蹤：**
  - 確認客戶滿意度
  - 處理結果記錄
  - 改善措施

✅ 回應範本（3 種情境）

  **情境 1 - 一般查詢**
  ```
  您好，感謝您的詢問！

  [針對問題的回答]

  如有其他問題，歡迎隨時聯繫我們 😊
  ```

  **情境 2 - 品質客訴**
  ```
  [客戶名稱] 您好，

  非常抱歉造成您不好的用餐體驗，這確實是我們的疏失。

  [說明問題與原因]

  為了表達我們的歉意，我們將提供：
  [補償方案]

  我們已經立即進行 [改善措施]，未來會更加注意。

  再次向您致上最深的歉意，希望能再給我們一次服務您的機會。
  ```

  **情境 3 - 緊急狀況**
  ```
  [客戶名稱] 您好，

  我是弘爺漢堡 [職稱+姓名]，剛剛了解到您的狀況，我們非常重視這個問題。

  [立即處理行動]

  [補償與負責說明]

  我會親自跟進此案，確保問題圓滿解決。
  我的聯絡方式：[電話]

  再次致上最深的歉意。
  ```

✅ 補償方案建議

  **輕度問題：**
  - 口頭道歉 + 說明
  - 小額折價券

  **中度問題：**
  - 退款
  - 重做商品
  - 折價券或贈品

  **重度問題：**
  - 全額退款
  - 補償商品
  - 高額折價券
  - 主管親自致歉

✅ 客服話術技巧
  - 同理心表達
  - 避免推卸責任
  - 正面表述
  - 明確承諾
  - 追蹤確認

✅ 預防措施
  - 問題根源分析
  - 流程改善建議
  - SOP 優化
  - 教育訓練

✅ 常見問題 FAQ
✅ 升級處理機制（何時需要主管介入）
"""

    def _get_performance_tracking_prompt(self, context: Dict) -> str:
        """成效追蹤提示詞"""
        return """請幫我分析團購成效。

**成效追蹤架構：**

**1. 銷售表現**
- 業績達成率
- 訂單分析
- 產品表現

**2. 客戶分析**
- 客群分佈
- 購買行為
- 滿意度

**3. 管道分析**
- 各管道成效
- 成本效益
- 轉換率

**4. 優化建議**
- 問題診斷
- 改善方向
- 行動計畫

請根據以下資訊進行成效分析：

【請在此描述您的分析需求】
- 活動名稱：
- 活動期間：
- 銷售數據：
  - 總業績：
  - 總訂單數：
  - 總銷售量：
  - 目標業績：
- 產品數據：
  - 各產品銷量：
- 客戶數據：
  - 新客/舊客比例：
  - 客群分佈：
- 管道數據：
  - 各管道訂單數/業績：
- 成本數據：
  - 產品成本：
  - 行銷成本：
  - 物流成本：
  - 其他成本：
- 想了解的重點：

我將為您提供：
✅ 數據分析報告

  **一、整體表現**
  - 總業績與達成率
  - 總訂單數與成長
  - 平均客單價
  - 毛利與淨利
  - 與目標比較
  - 與上期比較

  **二、銷售分析**
  - 日銷售趨勢
  - 高峰時段
  - 熱銷時段分析

  **三、產品分析**
  - 熱銷 TOP 5
  - 滯銷產品
  - 組合商品效益
  - 產品毛利貢獻
  - 庫存周轉

  **四、客戶分析**
  - 客群分佈（新客/舊客/VIP）
  - 平均購買量
  - 客戶取得成本
  - 客戶終身價值預估
  - 回購率分析

  **五、管道分析**
  - 各管道訂單數
  - 各管道業績
  - 各管道客單價
  - 各管道成本
  - ROI 比較

  **六、滿意度分析**
  - 整體滿意度
  - 產品滿意度
  - 服務滿意度
  - NPS 淨推薦值
  - 客訴率

✅ 關鍵洞察
  - 表現亮點
  - 問題發現
  - 機會點
  - 風險點

✅ 優化建議（分優先級）

  **高優先級（立即執行）：**
  - [具體建議 1]
  - [具體建議 2]

  **中優先級（本月執行）：**
  - [具體建議 1]
  - [具體建議 2]

  **低優先級（後續規劃）：**
  - [具體建議 1]
  - [具體建議 2]

✅ 下次活動建議
  - 產品組合優化
  - 價格策略調整
  - 推廣管道調整
  - 時程安排建議

✅ KPI 設定建議
  - 業績目標
  - 訂單目標
  - 客單價目標
  - 新客獲取目標
  - 滿意度目標
"""

    def _get_crisis_handling_prompt(self, context: Dict) -> str:
        """危機處理提示詞"""
        return """請幫我處理團購危機。

**危機處理流程：**

**1. 快速評估**
- 嚴重程度
- 影響範圍
- 擴散風險

**2. 立即應對**
- 停損動作
- 對外說明
- 內部協調

**3. 根本解決**
- 問題修正
- 補償執行
- 信任重建

**4. 預防改善**
- 原因分析
- 流程改善
- SOP 建立

請根據以下資訊提供危機處理建議：

【請在此描述危機狀況】
- 危機類型：
  □ 產品品質問題（食材/製作/包裝）
  □ 配送問題（延遲/錯誤/損壞）
  □ 服務問題（客服/溝通/態度）
  □ 食安問題（異物/過敏/中毒）
  □ 系統問題（訂單/金流/資料）
  □ 其他：
- 事件描述：
- 發生時間：
- 影響範圍：
  - 影響訂單數：
  - 影響人數：
  - 是否有媒體關注：
- 目前狀況：
- 已採取行動：
- 可用資源：

我將為您提供：
✅ 危機等級評估

  **等級判定：**
  - Level 1（低）：單一客戶，可快速處理
  - Level 2（中）：多位客戶，需立即處理
  - Level 3（高）：大量客戶，嚴重影響
  - Level 4（緊急）：食安/法律/媒體問題

  **您的情況：** Level _

  **風險分析：**
  - 直接損失
  - 商譽影響
  - 法律風險
  - 擴散可能性

✅ 立即行動（1 小時內）

  **停損動作：**
  - [具體行動 1]
  - [具體行動 2]
  - [具體行動 3]

  **通報機制：**
  - 內部通報（主管/相關部門）
  - 外部通報（廠商/合作夥伴）

  **資訊管控：**
  - 統一發言口徑
  - 指定發言人
  - 監控輿論

✅ 溝通策略

  **對客戶溝通：**
  - 個別聯繫（電話/訊息）
  - 群組公告
  - 官方聲明（如需要）

  **溝通範本：**
  ```
  各位親愛的客戶，大家好：

  關於 [事件]，我們要向大家致上最深的歉意。

  【事件說明】
  [客觀說明發生什麼事]

  【處理進度】
  我們已經立即採取以下措施：
  1. [措施 1]
  2. [措施 2]
  3. [措施 3]

  【補償方案】
  為了表達我們的歉意，我們將提供：
  [具體補償內容]

  【後續行動】
  [改善措施與承諾]

  我們會負責到底，如有任何問題，請隨時聯繫我們。
  聯絡窗口：[姓名] [電話]

  再次向大家致上最深的歉意。

  弘爺漢堡團隊 敬上
  ```

  **對廠商溝通：**
  - 說明狀況
  - 請求協助
  - 後續合作

  **內部溝通：**
  - 狀況通報
  - 任務分工
  - 進度更新

✅ 補償方案（3 個層級）

  **方案 A - 基礎補償**
  - 適用對象
  - 補償內容
  - 預估成本

  **方案 B - 標準補償**
  - 適用對象
  - 補償內容
  - 預估成本

  **方案 C - 升級補償**
  - 適用對象
  - 補償內容
  - 預估成本

✅ 危機處理 SOP
  1. 接獲通報（15 分鐘內）
  2. 快速評估（30 分鐘內）
  3. 啟動應變（1 小時內）
  4. 對外說明（視情況）
  5. 補償執行（1-3 天）
  6. 追蹤確認（1 週內）
  7. 檢討改善（1 週內）

✅ 後續追蹤計畫
  - 客戶滿意度追蹤
  - 補償執行追蹤
  - 改善措施執行
  - 定期回報機制

✅ 預防機制建議
  - 問題根源分析
  - 流程改善（具體建議）
  - 檢查機制強化
  - 教育訓練
  - 應變 SOP 建立

✅ 案例記錄建議
  - 記錄格式
  - 關鍵資訊
  - 經驗傳承
"""

    def start_workflow(self, workflow_type: str, user_input: str = "") -> str:
        """
        啟動特定工作流程

        Args:
            workflow_type: 工作流程類型
            user_input: 用戶輸入

        Returns:
            助手回應
        """
        # 獲取工作流程提示詞
        workflow_prompt = self.get_workflow_prompt(workflow_type)

        if not workflow_prompt:
            return "抱歉，不支援此工作流程。請輸入 /workflows 查看所有可用的工作流程。"

        # 組合完整訊息
        full_message = f"{workflow_prompt}\n\n{user_input}" if user_input else workflow_prompt

        # 使用 chat 方法處理
        return self.chat(full_message)

    def list_workflows(self) -> str:
        """列出所有可用的工作流程"""
        return """
# 人員 E (團購PM) 可用工作流程

## 📅 專案規劃類
1. **團購企劃** (`/plan`)
   - 完整活動企劃
   - 產品與價格策略

2. **廠商管理** (`/vendor`)
   - 廠商開發與維護
   - 合作方案設計

## 🚚 執行管理類
3. **物流配送** (`/logistics`)
   - 配送方案規劃
   - 流程與品質管控

4. **客服處理** (`/cs`)
   - 客戶問題處理
   - 回應範本與話術

## 📊 成效優化類
5. **成效追蹤** (`/track`)
   - 數據分析報告
   - 優化建議

6. **危機處理** (`/crisis`)
   - 危機應對策略
   - 補償與改善方案

---

**快速使用：** 直接輸入指令（如 `/plan`）或描述您的需求！
"""
