#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
弘爺漢堡 AI Agent 指令系統 - 資料提取與文檔產生器
"""

import os
import re
import json
import csv
from pathlib import Path

COMMANDS_DIR = "/home/user/roaddy/.claude/commands"

# 定義主分類與次分類對應
CATEGORY_MAPPING = {
    # 行銷企劃
    "文案生成": "行銷企劃",
    "社群文案": "行銷企劃",
    "公關傳播": "行銷企劃",
    "活動企劃": "行銷企劃",
    "品牌策略": "行銷企劃",
    "內容策略": "行銷企劃",
    "市場研究": "行銷企劃",
    "促銷活動": "行銷企劃",

    # 數位行銷
    "廣告投放": "數位行銷",
    "SEO優化": "數位行銷",
    "社群經營": "數位行銷",
    "KOL合作": "數位行銷",
    "轉換優化": "數位行銷",
    "數位廣告": "數位行銷",
    "平台經營": "數位行銷",

    # 數據分析
    "數據分析": "數據分析",
    "報表製作": "數據分析",
    "顧客分析": "數據分析",
    "績效分析": "數據分析",
    "市場分析": "數據分析",
    "競爭分析": "數據分析",
    "趨勢分析": "數據分析",

    # 視覺設計
    "視覺設計": "視覺設計",
    "品牌視覺": "視覺設計",
    "素材製作": "視覺設計",
    "UI設計": "視覺設計",
    "版面設計": "視覺設計",

    # 專案管理
    "專案規劃": "專案管理",
    "進度管理": "專案管理",
    "風險管理": "專案管理",
    "資源管理": "專案管理",
    "會議管理": "專案管理",

    # 經營管理
    "策略規劃": "經營管理",
    "預算管理": "經營管理",
    "績效管理": "經營管理",
    "人力資源": "經營管理",
    "門市管理": "經營管理",
    "財務分析": "經營管理",

    # 客戶經營
    "客戶服務": "客戶經營",
    "會員經營": "客戶經營",
    "客訴處理": "客戶經營",
    "CRM": "客戶經營",
    "顧客旅程": "客戶經營",

    # 供應商管理
    "供應商管理": "供應商管理",
    "採購管理": "供應商管理",
    "合約管理": "供應商管理",
    "品質管理": "供應商管理",

    # 加盟與展覽
    "加盟業務": "加盟與展覽",
    "展覽活動": "加盟與展覽",
    "商業開發": "加盟與展覽",

    # IP授權專項
    "IP合作": "IP授權專項",
    "授權管理": "IP授權專項",
    "聯名企劃": "IP授權專項",

    # 溝通協作
    "內部溝通": "溝通協作",
    "報告撰寫": "溝通協作",
    "簡報製作": "溝通協作",

    # 學習系統
    "學習優化": "學習系統",
    "系統設定": "學習系統",
}

# 指令詳細資料定義（根據參考圖片格式）
COMMAND_DETAILS = {
    # === 行銷企劃 ===
    "aida": {"功能說明": "AIDA行銷文案產生器", "預期產出": "AIDA框架行銷文案（含完整版、社群簡潔版）", "次分類": "文案生成", "標籤": "產生器", "框架": "AIDA"},
    "fab": {"功能說明": "FAB產品文案產生器", "預期產出": "FAB框架文案（特性→優勢→利益）產品介紹", "次分類": "文案生成", "標籤": "產生器", "框架": "FAB"},
    "pas": {"功能說明": "PAS痛點文案產生器", "預期產出": "PAS框架文案（痛點→加劇→解方）銷售文案", "次分類": "文案生成", "標籤": "產生器", "框架": "PAS"},
    "hook": {"功能說明": "爆款開頭產生器", "預期產出": "吸睛開頭句型（設定一場景→製造衝突）", "次分類": "文案生成", "標籤": "產生器", "框架": "-"},
    "title": {"功能說明": "吸睛標題產生器", "預期產出": "10個以上高點擊率標題選項", "次分類": "文案生成", "標籤": "產生器", "框架": "-"},
    "copy": {"功能說明": "萬用文案產生器", "預期產出": "多版本行銷文案（長版、短版、社群版）", "次分類": "文案生成", "標籤": "產生器", "框架": "-"},
    "naming": {"功能說明": "產品命名產生器", "預期產出": "品牌/產品命名建議（含寓意說明）", "次分類": "品牌策略", "標籤": "產生器", "框架": "-"},
    "slogan": {"功能說明": "品牌標語產生器", "預期產出": "品牌Slogan與Tagline建議", "次分類": "品牌策略", "標籤": "產生器", "框架": "-"},
    "post": {"功能說明": "社群貼文產生器", "預期產出": "社群平台貼文（含Hashtag建議）", "次分類": "社群文案", "標籤": "產生器", "框架": "-"},
    "fbpost": {"功能說明": "Facebook貼文產生器", "預期產出": "FB專用貼文（含互動問句、Hashtag）", "次分類": "社群文案", "標籤": "產生器", "框架": "FB Engagement"},
    "igpost": {"功能說明": "Instagram貼文產生器", "預期產出": "IG專用貼文（含視覺建議、Hashtag策略）", "次分類": "社群文案", "標籤": "產生器", "框架": "IG Content"},
    "linkedinpost": {"功能說明": "LinkedIn貼文產生器", "預期產出": "專業社群貼文（B2B導向）", "次分類": "社群文案", "標籤": "產生器", "框架": "-"},
    "threadpost": {"功能說明": "Threads貼文產生器", "預期產出": "Threads專用對話式貼文", "次分類": "社群文案", "標籤": "產生器", "框架": "-"},
    "story": {"功能說明": "品牌故事產生器", "預期產出": "品牌故事敘事文案", "次分類": "品牌策略", "標籤": "產生器", "框架": "Hero's Journey"},
    "viral": {"功能說明": "病毒式內容產生器", "預期產出": "高分享性內容企劃", "次分類": "內容策略", "標籤": "產生器", "框架": "STEPPS"},
    "webpage": {"功能說明": "網頁文案產生器", "預期產出": "Landing Page文案（含CTA設計）", "次分類": "文案生成", "標籤": "產生器", "框架": "-"},
    "calendar": {"功能說明": "行銷檔期規劃器", "預期產出": "年度/季度行銷檔期日曆", "次分類": "活動企劃", "標籤": "規劃器", "框架": "-"},
    "blogpost": {"功能說明": "部落格文章產生器", "預期產出": "SEO友善部落格文章", "次分類": "內容策略", "標籤": "產生器", "框架": "-"},
    "reply": {"功能說明": "社群回覆產生器", "預期產出": "粉絲留言回覆範本", "次分類": "社群文案", "標籤": "產生器", "框架": "-"},
    "ugc": {"功能說明": "UGC內容企劃產生器", "預期產出": "使用者原創內容活動企劃", "次分類": "內容策略", "標籤": "產生器", "框架": "-"},
    "rewrite": {"功能說明": "文案改寫優化器", "預期產出": "優化後的行銷文案（多版本）", "次分類": "文案生成", "標籤": "優化器", "框架": "-"},
    "holiday": {"功能說明": "節慶文案產生器", "預期產出": "節慶主題行銷文案", "次分類": "活動企劃", "標籤": "產生器", "框架": "-"},
    "tvc": {"功能說明": "廣告腳本產生器", "預期產出": "TVC/影片廣告腳本", "次分類": "公關傳播", "標籤": "產生器", "框架": "-"},
    "press": {"功能說明": "新聞稿產生器", "預期產出": "品牌新聞稿（含標題、導言、正文）", "次分類": "公關傳播", "標籤": "產生器", "框架": "倒金字塔"},
    "pressconf": {"功能說明": "記者會企劃產生器", "預期產出": "記者會活動企劃書", "次分類": "公關傳播", "標籤": "產生器", "框架": "-"},
    "mediakit": {"功能說明": "媒體資料夾產生器", "預期產出": "品牌Media Kit內容規劃", "次分類": "公關傳播", "標籤": "產生器", "框架": "-"},
    "mediaschedule": {"功能說明": "媒體排期產生器", "預期產出": "媒體投放排程表", "次分類": "公關傳播", "標籤": "排程器", "框架": "-"},
    "storepost": {"功能說明": "門市公告產生器", "預期產出": "店內公告/海報文案", "次分類": "社群文案", "標籤": "產生器", "框架": "-"},
    "multiplatform": {"功能說明": "多平台內容適配器", "預期產出": "各平台客製化版本文案", "次分類": "內容策略", "標籤": "轉換器", "框架": "-"},
    "proposal": {"功能說明": "行銷提案產生器", "預期產出": "完整行銷提案書", "次分類": "活動企劃", "標籤": "產生器", "框架": "-"},
    "styleguide": {"功能說明": "文案風格指南產生器", "預期產出": "品牌文案風格指南", "次分類": "品牌策略", "標籤": "指南", "框架": "-"},
    "seasonal": {"功能說明": "季節性行銷企劃產生器", "預期產出": "季節性行銷活動完整企劃", "次分類": "活動企劃", "標籤": "產生器", "框架": "-"},
    "launch": {"功能說明": "新品上市企劃產生器", "預期產出": "新品上市行銷企劃書", "次分類": "活動企劃", "標籤": "產生器", "框架": "Launch Framework"},
    "jtbd": {"功能說明": "JTBD顧客任務分析器", "預期產出": "顧客待完成任務分析報告", "次分類": "市場研究", "標籤": "分析器", "框架": "JTBD"},
    "4p": {"功能說明": "4P行銷組合分析器", "預期產出": "產品/價格/通路/推廣策略分析", "次分類": "品牌策略", "標籤": "分析器", "框架": "4P"},
    "abtest": {"功能說明": "A/B測試規劃器", "預期產出": "A/B測試實驗設計方案", "次分類": "市場研究", "標籤": "規劃器", "框架": "A/B Testing"},
    "cacltv": {"功能說明": "CAC/LTV分析器", "預期產出": "顧客獲取成本與終身價值分析", "次分類": "市場研究", "標籤": "分析器", "框架": "CAC/LTV"},

    # === 數位行銷 ===
    "targetaudience": {"功能說明": "目標受眾分析器", "預期產出": "TA輪廓分析報告", "次分類": "顧客分析", "標籤": "分析器", "框架": "-"},
    "insight": {"功能說明": "消費者洞察分析器", "預期產出": "消費者行為洞察報告", "次分類": "顧客分析", "標籤": "分析器", "框架": "-"},
    "rfm": {"功能說明": "RFM顧客分群分析器", "預期產出": "顧客價值分群報告", "次分類": "顧客分析", "標籤": "分析器", "框架": "RFM"},
    "cross": {"功能說明": "交叉銷售分析器", "預期產出": "交叉銷售/向上銷售建議", "次分類": "轉換優化", "標籤": "分析器", "框架": "-"},
    "adbudget": {"功能說明": "廣告預算分配器", "預期產出": "廣告預算配置建議", "次分類": "廣告投放", "標籤": "規劃器", "框架": "-"},
    "bidstrategy": {"功能說明": "出價策略產生器", "預期產出": "廣告出價策略建議", "次分類": "廣告投放", "標籤": "產生器", "框架": "-"},
    "kol": {"功能說明": "KOL合作企劃產生器", "預期產出": "網紅合作企劃書", "次分類": "KOL合作", "標籤": "產生器", "框架": "-"},
    "retarget": {"功能說明": "再行銷策略產生器", "預期產出": "Retargeting廣告策略", "次分類": "廣告投放", "標籤": "產生器", "框架": "-"},
    "conversion": {"功能說明": "轉換率優化分析器", "預期產出": "CRO優化建議報告", "次分類": "轉換優化", "標籤": "分析器", "框架": "CRO"},
    "adfunnel": {"功能說明": "廣告漏斗規劃器", "預期產出": "廣告漏斗策略規劃", "次分類": "廣告投放", "標籤": "規劃器", "框架": "AARRR"},
    "landing": {"功能說明": "Landing Page規劃器", "預期產出": "到達頁面架構與文案規劃", "次分類": "轉換優化", "標籤": "規劃器", "框架": "-"},
    "contentseo": {"功能說明": "內容SEO優化器", "預期產出": "SEO優化內容建議", "次分類": "SEO優化", "標籤": "優化器", "框架": "-"},
    "techseo": {"功能說明": "技術SEO檢查器", "預期產出": "技術SEO檢查清單", "次分類": "SEO優化", "標籤": "檢查器", "框架": "Technical SEO"},
    "keyword": {"功能說明": "關鍵字策略產生器", "預期產出": "SEO關鍵字策略建議", "次分類": "SEO優化", "標籤": "產生器", "框架": "-"},
    "interaction": {"功能說明": "互動機制設計器", "預期產出": "社群互動活動機制設計", "次分類": "社群經營", "標籤": "設計器", "框架": "-"},
    "hashtag": {"功能說明": "Hashtag策略產生器", "預期產出": "社群Hashtag策略建議", "次分類": "社群經營", "標籤": "產生器", "框架": "-"},
    "monthcontent": {"功能說明": "月度內容規劃器", "預期產出": "月度內容排程計畫", "次分類": "內容策略", "標籤": "規劃器", "框架": "-"},
    "kpiset": {"功能說明": "行銷KPI設定器", "預期產出": "行銷KPI指標設定建議", "次分類": "績效分析", "標籤": "設定器", "框架": "-"},
    "adplatform": {"功能說明": "廣告平台選擇器", "預期產出": "廣告平台配置建議", "次分類": "廣告投放", "標籤": "分析器", "框架": "-"},
    "socialcalendar": {"功能說明": "社群日曆產生器", "預期產出": "社群內容排程日曆", "次分類": "社群經營", "標籤": "排程器", "框架": "-"},
    "funnel": {"功能說明": "行銷漏斗分析器", "預期產出": "AARRR漏斗各階段分析報告", "次分類": "數據分析", "標籤": "分析器", "框架": "AARRR"},
    "segmentation": {"功能說明": "顧客分群策略器", "預期產出": "顧客區隔策略建議", "次分類": "顧客分析", "標籤": "策略器", "框架": "-"},
    "attribution": {"功能說明": "廣告歸因分析器", "預期產出": "多通路歸因分析報告", "次分類": "廣告投放", "標籤": "分析器", "框架": "Attribution"},
    "dataviz": {"功能說明": "數據視覺化設計器", "預期產出": "數據圖表設計建議", "次分類": "報表製作", "標籤": "設計器", "框架": "-"},

    # === 數據分析 ===
    "survey": {"功能說明": "問卷設計產生器", "預期產出": "市調問卷設計", "次分類": "市場分析", "標籤": "產生器", "框架": "-"},
    "trend": {"功能說明": "趨勢分析產生器", "預期產出": "市場趨勢分析報告", "次分類": "趨勢分析", "標籤": "分析器", "框架": "-"},
    "attr": {"功能說明": "產品屬性分析器", "預期產出": "產品屬性與賣點分析", "次分類": "市場分析", "標籤": "分析器", "框架": "-"},
    "performance": {"功能說明": "績效報告產生器", "預期產出": "行銷績效分析報告", "次分類": "績效分析", "標籤": "產生器", "框架": "-"},
    "datatext": {"功能說明": "數據解讀產生器", "預期產出": "數據摘要與洞察文字", "次分類": "數據分析", "標籤": "產生器", "框架": "-"},
    "dashboard": {"功能說明": "儀表板指標設計器", "預期產出": "Dashboard指標配置建議", "次分類": "報表製作", "標籤": "設計器", "框架": "-"},
    "cohort": {"功能說明": "世代分析產生器", "預期產出": "Cohort分析報告", "次分類": "顧客分析", "標籤": "分析器", "框架": "Cohort"},
    "pivot": {"功能說明": "樞紐分析輔助器", "預期產出": "樞紐分析表設計建議", "次分類": "數據分析", "標籤": "輔助器", "框架": "-"},
    "content": {"功能說明": "內容成效分析器", "預期產出": "內容行銷成效報告", "次分類": "績效分析", "標籤": "分析器", "框架": "-"},
    "review": {"功能說明": "評論分析產生器", "預期產出": "顧客評論分析報告", "次分類": "市場分析", "標籤": "分析器", "框架": "-"},
    "benchmark": {"功能說明": "標竿分析產生器", "預期產出": "業界標竿比較報告", "次分類": "競爭分析", "標籤": "分析器", "框架": "Benchmarking"},
    "compete": {"功能說明": "競爭者分析產生器", "預期產出": "競爭對手分析報告", "次分類": "競爭分析", "標籤": "分析器", "框架": "-"},
    "comparison": {"功能說明": "產品比較分析器", "預期產出": "產品功能比較表", "次分類": "競爭分析", "標籤": "分析器", "框架": "-"},
    "sentiment": {"功能說明": "輿情分析產生器", "預期產出": "品牌輿情監測報告", "次分類": "市場分析", "標籤": "分析器", "框架": "-"},
    "datainsight": {"功能說明": "數據洞察產生器", "預期產出": "數據驅動洞察報告", "次分類": "數據分析", "標籤": "產生器", "框架": "-"},
    "htmldashboard": {"功能說明": "HTML儀表板產生器", "預期產出": "互動式HTML Dashboard", "次分類": "報表製作", "標籤": "產生器", "框架": "-"},
    "persona": {"功能說明": "人物誌產生器", "預期產出": "目標客群Persona卡片", "次分類": "顧客分析", "標籤": "產生器", "框架": "Persona"},
    "datasheet": {"功能說明": "數據表格整理器", "預期產出": "結構化數據表格", "次分類": "數據分析", "標籤": "整理器", "框架": "-"},
    "csvguide": {"功能說明": "CSV資料處理指南", "預期產出": "CSV資料清理與分析建議", "次分類": "數據分析", "標籤": "指南", "框架": "-"},
    "brandhealth": {"功能說明": "品牌健康度分析器", "預期產出": "品牌健康度追蹤報告", "次分類": "市場分析", "標籤": "分析器", "框架": "Brand Health"},

    # === 專案管理 ===
    "strategy": {"功能說明": "策略規劃產生器", "預期產出": "整體策略規劃文件", "次分類": "策略規劃", "標籤": "產生器", "框架": "-"},
    "annual": {"功能說明": "年度計畫產生器", "預期產出": "年度行銷計畫書", "次分類": "策略規劃", "標籤": "產生器", "框架": "ANNUAL-PLAN"},
    "okr": {"功能說明": "OKR設定產生器", "預期產出": "OKR目標設定表", "次分類": "策略規劃", "標籤": "產生器", "框架": "OKR"},
    "budget": {"功能說明": "預算規劃產生器", "預期產出": "行銷預算規劃表", "次分類": "預算管理", "標籤": "規劃器", "框架": "-"},
    "task": {"功能說明": "任務分解產生器", "預期產出": "WBS工作分解結構", "次分類": "進度管理", "標籤": "產生器", "框架": "WBS"},
    "risk": {"功能說明": "風險評估產生器", "預期產出": "風險評估矩陣", "次分類": "風險管理", "標籤": "產生器", "框架": "Risk Matrix"},
    "crisis": {"功能說明": "危機處理SOP產生器", "預期產出": "危機應變SOP", "次分類": "風險管理", "標籤": "產生器", "框架": "-"},
    "swot": {"功能說明": "SWOT分析產生器", "預期產出": "SWOT分析報告（含交叉策略）", "次分類": "策略規劃", "標籤": "分析器", "框架": "SWOT"},
    "raci": {"功能說明": "RACI矩陣產生器", "預期產出": "專案責任分工表", "次分類": "資源管理", "標籤": "產生器", "框架": "RACI"},
    "gantt": {"功能說明": "甘特圖產生器", "預期產出": "專案進度甘特圖", "次分類": "進度管理", "標籤": "產生器", "框架": "Gantt"},
    "meeting": {"功能說明": "會議議程產生器", "預期產出": "會議議程表", "次分類": "會議管理", "標籤": "產生器", "框架": "-"},
    "minutes": {"功能說明": "會議記錄產生器", "預期產出": "結構化會議記錄", "次分類": "會議管理", "標籤": "產生器", "框架": "-"},
    "ppt": {"功能說明": "簡報大綱產生器", "預期產出": "簡報架構與內容大綱", "次分類": "報告撰寫", "標籤": "產生器", "框架": "-"},
    "brief": {"功能說明": "專案簡報產生器", "預期產出": "專案Brief文件", "次分類": "報告撰寫", "標籤": "產生器", "框架": "-"},
    "check": {"功能說明": "檢核清單產生器", "預期產出": "任務檢核清單", "次分類": "進度管理", "標籤": "產生器", "框架": "-"},
    "crisisplan": {"功能說明": "危機應變計畫產生器", "預期產出": "完整危機應變計畫書", "次分類": "風險管理", "標籤": "產生器", "框架": "Crisis Management"},
    "scheduling": {"功能說明": "排程優化產生器", "預期產出": "人力/資源排程表", "次分類": "資源管理", "標籤": "優化器", "框架": "-"},
    "serviceblueprint": {"功能說明": "服務藍圖產生器", "預期產出": "服務流程藍圖", "次分類": "專案規劃", "標籤": "產生器", "框架": "Service Blueprint"},

    # === 經營管理 ===
    "brand": {"功能說明": "品牌策略產生器", "預期產出": "品牌定位與策略文件", "次分類": "品牌策略", "標籤": "產生器", "框架": "-"},
    "sop": {"功能說明": "SOP流程產生器", "預期產出": "標準作業流程文件", "次分類": "門市管理", "標籤": "產生器", "框架": "-"},
    "train": {"功能說明": "教育訓練產生器", "預期產出": "教育訓練教材", "次分類": "人力資源", "標籤": "產生器", "框架": "-"},
    "qc": {"功能說明": "品質管理檢核表", "預期產出": "品質檢核SOP", "次分類": "品質管理", "標籤": "檢核表", "框架": "-"},
    "storekpi": {"功能說明": "門市KPI設定器", "預期產出": "門市績效指標設定", "次分類": "門市管理", "標籤": "設定器", "框架": "BSC"},
    "qualitycontrol": {"功能說明": "品質管控流程產生器", "預期產出": "品質管控流程文件", "次分類": "品質管理", "標籤": "產生器", "框架": "QC"},
    "recruitment": {"功能說明": "招募流程規劃器", "預期產出": "招募需求與流程規劃", "次分類": "人力資源", "標籤": "規劃器", "框架": "-"},
    "onboarding": {"功能說明": "新人入職計畫產生器", "預期產出": "新人Onboarding計畫", "次分類": "人力資源", "標籤": "產生器", "框架": "-"},
    "performancereview": {"功能說明": "績效考核模板產生器", "預期產出": "績效考核表單與標準", "次分類": "人力資源", "標籤": "產生器", "框架": "-"},
    "budgeting": {"功能說明": "預算編列分析器", "預期產出": "部門預算編列建議", "次分類": "財務分析", "標籤": "分析器", "框架": "-"},
    "profitloss": {"功能說明": "損益分析產生器", "預期產出": "產品/活動損益分析", "次分類": "財務分析", "標籤": "分析器", "框架": "P&L"},

    # === 客戶經營 ===
    "crm": {"功能說明": "CRM策略產生器", "預期產出": "顧客關係管理策略", "次分類": "CRM", "標籤": "產生器", "框架": "CRM"},
    "quote": {"功能說明": "報價單產生器", "預期產出": "客製化報價單", "次分類": "客戶服務", "標籤": "產生器", "框架": "-"},
    "complaint": {"功能說明": "客訴回覆產生器", "預期產出": "客訴處理回覆範本", "次分類": "客訴處理", "標籤": "產生器", "框架": "-"},
    "email": {"功能說明": "Email模板產生器", "預期產出": "商業Email範本", "次分類": "客戶服務", "標籤": "產生器", "框架": "-"},
    "voc": {"功能說明": "VOC顧客心聲分析器", "預期產出": "顧客意見分析報告", "次分類": "顧客旅程", "標籤": "分析器", "框架": "VOC"},
    "loyaltyprogram": {"功能說明": "會員忠誠計畫產生器", "預期產出": "會員經營計畫書", "次分類": "會員經營", "標籤": "產生器", "框架": "Loyalty"},
    "journey": {"功能說明": "顧客旅程產生器", "預期產出": "Customer Journey Map", "次分類": "顧客旅程", "標籤": "產生器", "框架": "Journey Map"},
    "member": {"功能說明": "會員分級產生器", "預期產出": "會員等級制度設計", "次分類": "會員經營", "標籤": "產生器", "框架": "-"},
    "feedback": {"功能說明": "回饋機制設計器", "預期產出": "顧客回饋收集機制", "次分類": "顧客旅程", "標籤": "設計器", "框架": "-"},
    "satisfaction": {"功能說明": "滿意度調查產生器", "預期產出": "顧客滿意度調查問卷", "次分類": "顧客旅程", "標籤": "產生器", "框架": "NPS/CSAT"},
    "touchpoint": {"功能說明": "接觸點分析器", "預期產出": "顧客接觸點優化建議", "次分類": "顧客旅程", "標籤": "分析器", "框架": "-"},
    "nps": {"功能說明": "NPS分析產生器", "預期產出": "淨推薦值分析報告", "次分類": "顧客旅程", "標籤": "分析器", "框架": "NPS"},
    "faq": {"功能說明": "FAQ產生器", "預期產出": "常見問題集", "次分類": "客戶服務", "標籤": "產生器", "框架": "-"},
    "csscript": {"功能說明": "客服話術產生器", "預期產出": "客服應對話術範本", "次分類": "客戶服務", "標籤": "產生器", "框架": "-"},
    "chatbot": {"功能說明": "聊天機器人腳本產生器", "預期產出": "Chatbot對話腳本", "次分類": "客戶服務", "標籤": "產生器", "框架": "-"},

    # === 供應商管理 ===
    "supplier": {"功能說明": "供應商評估產生器", "預期產出": "供應商評估報告", "次分類": "供應商管理", "標籤": "產生器", "框架": "-"},
    "contract": {"功能說明": "合約條款產生器", "預期產出": "合約條款建議", "次分類": "合約管理", "標籤": "產生器", "框架": "-"},
    "negotiate": {"功能說明": "議價策略產生器", "預期產出": "議價談判策略", "次分類": "採購管理", "標籤": "產生器", "框架": "-"},
    "purchase": {"功能說明": "採購需求產生器", "預期產出": "採購需求規格書", "次分類": "採購管理", "標籤": "產生器", "框架": "-"},
    "vendorcomp": {"功能說明": "供應商比較分析器", "預期產出": "供應商比較評估表", "次分類": "供應商管理", "標籤": "分析器", "框架": "-"},
    "inventory": {"功能說明": "庫存管理分析器", "預期產出": "庫存水位分析與建議", "次分類": "採購管理", "標籤": "分析器", "框架": "-"},
    "logistics": {"功能說明": "物流規劃產生器", "預期產出": "物流配送規劃方案", "次分類": "供應商管理", "標籤": "規劃器", "框架": "-"},
    "groupbuy": {"功能說明": "團購活動企劃產生器", "預期產出": "團購活動企劃書", "次分類": "採購管理", "標籤": "產生器", "框架": "-"},
    "costcontrol": {"功能說明": "成本控管分析器", "預期產出": "成本分析與優化建議", "次分類": "採購管理", "標籤": "分析器", "框架": "-"},

    # === 加盟與展覽 ===
    "franchise": {"功能說明": "加盟說明產生器", "預期產出": "加盟說明資料", "次分類": "加盟業務", "標籤": "產生器", "框架": "-"},
    "exhibit": {"功能說明": "展覽企劃產生器", "預期產出": "展覽活動企劃書", "次分類": "展覽活動", "標籤": "產生器", "框架": "-"},
    "booth": {"功能說明": "攤位設計產生器", "預期產出": "展覽攤位設計規劃", "次分類": "展覽活動", "標籤": "產生器", "框架": "-"},
    "franchiseqa": {"功能說明": "加盟QA產生器", "預期產出": "加盟常見問題集", "次分類": "加盟業務", "標籤": "產生器", "框架": "-"},
    "location": {"功能說明": "選址評估產生器", "預期產出": "門市選址評估報告", "次分類": "加盟業務", "標籤": "分析器", "框架": "-"},
    "franchisedoc": {"功能說明": "加盟文件產生器", "預期產出": "加盟合約與文件範本", "次分類": "加盟業務", "標籤": "產生器", "框架": "-"},
    "exhibitlead": {"功能說明": "展覽名單整理器", "預期產出": "展覽潛客名單整理", "次分類": "展覽活動", "標籤": "整理器", "框架": "-"},
    "tradeshow": {"功能說明": "展會策略產生器", "預期產出": "參展策略規劃", "次分類": "展覽活動", "標籤": "產生器", "框架": "-"},
    "franchisetrain": {"功能說明": "加盟商培訓產生器", "預期產出": "加盟商培訓計畫", "次分類": "加盟業務", "標籤": "產生器", "框架": "-"},
    "bdplan": {"功能說明": "商業開發計畫產生器", "預期產出": "商業開發策略計畫", "次分類": "商業開發", "標籤": "產生器", "框架": "-"},

    # === IP授權專項 ===
    "ipcollab": {"功能說明": "IP聯名企劃產生器", "預期產出": "IP聯名企劃書", "次分類": "IP合作", "標籤": "產生器", "框架": "-"},
    "ipeval": {"功能說明": "IP授權評估產生器", "預期產出": "IP授權可行性評估", "次分類": "授權管理", "標籤": "分析器", "框架": "-"},
    "ipcampaign": {"功能說明": "IP活動企劃產生器", "預期產出": "IP主題活動企劃", "次分類": "聯名企劃", "標籤": "產生器", "框架": "-"},
    "ipcontract": {"功能說明": "IP合約條款產生器", "預期產出": "IP授權合約條款", "次分類": "授權管理", "標籤": "產生器", "框架": "-"},
    "ipmarketing": {"功能說明": "IP行銷策略產生器", "預期產出": "IP聯名行銷策略", "次分類": "聯名企劃", "標籤": "產生器", "框架": "-"},
    "ipproduct": {"功能說明": "IP商品企劃產生器", "預期產出": "IP聯名商品規劃", "次分類": "聯名企劃", "標籤": "產生器", "框架": "-"},
    "iproi": {"功能說明": "IP投資報酬分析器", "預期產出": "IP合作ROI分析", "次分類": "授權管理", "標籤": "分析器", "框架": "ROI"},

    # === 視覺設計 ===
    "poster": {"功能說明": "海報設計產生器", "預期產出": "海報設計規格與文案", "次分類": "素材製作", "標籤": "產生器", "框架": "-"},
    "dm": {"功能說明": "DM設計產生器", "預期產出": "DM版面規劃與文案", "次分類": "素材製作", "標籤": "產生器", "框架": "-"},
    "menu": {"功能說明": "菜單設計產生器", "預期產出": "菜單版面規劃建議", "次分類": "素材製作", "標籤": "產生器", "框架": "-"},
    "banner": {"功能說明": "Banner設計產生器", "預期產出": "Banner尺寸與文案規劃", "次分類": "素材製作", "標籤": "產生器", "框架": "-"},
    "visual": {"功能說明": "視覺方向產生器", "預期產出": "視覺設計方向建議", "次分類": "品牌視覺", "標籤": "產生器", "框架": "-"},
    "moodboard": {"功能說明": "Moodboard產生器", "預期產出": "視覺風格參考指南", "次分類": "品牌視覺", "標籤": "產生器", "框架": "-"},
    "color": {"功能說明": "配色方案產生器", "預期產出": "品牌配色建議", "次分類": "品牌視覺", "標籤": "產生器", "框架": "-"},
    "lptest": {"功能說明": "LP測試規劃器", "預期產出": "Landing Page測試方案", "次分類": "UI設計", "標籤": "規劃器", "框架": "A/B Testing"},
    "adcopy": {"功能說明": "廣告素材文案產生器", "預期產出": "廣告圖文素材規劃", "次分類": "素材製作", "標籤": "產生器", "框架": "-"},
    "sticker": {"功能說明": "貼圖設計產生器", "預期產出": "LINE貼圖設計規劃", "次分類": "素材製作", "標籤": "產生器", "框架": "-"},
    "packaging": {"功能說明": "包裝設計產生器", "預期產出": "產品包裝設計規劃", "次分類": "品牌視覺", "標籤": "產生器", "框架": "Package Design"},
    "photo": {"功能說明": "產品攝影指南產生器", "預期產出": "產品攝影腳本", "次分類": "素材製作", "標籤": "指南", "框架": "-"},
    "video": {"功能說明": "影片企劃產生器", "預期產出": "影片拍攝企劃", "次分類": "素材製作", "標籤": "產生器", "框架": "-"},
    "infographic": {"功能說明": "資訊圖表產生器", "預期產出": "Infographic設計規劃", "次分類": "素材製作", "標籤": "產生器", "框架": "-"},
    "template": {"功能說明": "模板設計產生器", "預期產出": "可重複使用設計模板", "次分類": "素材製作", "標籤": "產生器", "框架": "-"},
    "uidesign": {"功能說明": "UI設計規格產生器", "預期產出": "APP/Web UI設計規格", "次分類": "UI設計", "標籤": "產生器", "框架": "UI/UX"},
    "brandarch": {"功能說明": "品牌架構規劃器", "預期產出": "品牌視覺架構文件", "次分類": "品牌視覺", "標籤": "規劃器", "框架": "-"},
    "designsystem": {"功能說明": "設計系統產生器", "預期產出": "設計系統規範文件", "次分類": "品牌視覺", "標籤": "產生器", "框架": "Design System"},
    "vi": {"功能說明": "VI視覺識別產生器", "預期產出": "企業視覺識別規範", "次分類": "品牌視覺", "標籤": "產生器", "框架": "VI"},
    "layout": {"功能說明": "版面配置產生器", "預期產出": "版面設計配置建議", "次分類": "版面設計", "標籤": "產生器", "框架": "-"},
    "colorguide": {"功能說明": "色彩指南產生器", "預期產出": "色彩使用指南", "次分類": "品牌視覺", "標籤": "指南", "框架": "-"},
    "imageedit": {"功能說明": "圖片編輯指南產生器", "預期產出": "圖片編輯規範與建議", "次分類": "素材製作", "標籤": "指南", "框架": "-"},

    # === 溝通協作 ===
    "translate": {"功能說明": "多語言翻譯產生器", "預期產出": "多語言內容翻譯", "次分類": "內部溝通", "標籤": "產生器", "框架": "-"},
    "summary": {"功能說明": "文件摘要產生器", "預期產出": "文件重點摘要", "次分類": "內部溝通", "標籤": "產生器", "框架": "-"},
    "report": {"功能說明": "報告撰寫產生器", "預期產出": "正式報告文件", "次分類": "報告撰寫", "標籤": "產生器", "框架": "-"},
    "internal": {"功能說明": "內部公告產生器", "預期產出": "內部公告文案", "次分類": "內部溝通", "標籤": "產生器", "框架": "-"},
    "announce": {"功能說明": "公告文案產生器", "預期產出": "正式公告文案", "次分類": "內部溝通", "標籤": "產生器", "框架": "-"},
    "memo": {"功能說明": "備忘錄產生器", "預期產出": "內部備忘錄", "次分類": "內部溝通", "標籤": "產生器", "框架": "-"},
    "invitation": {"功能說明": "邀請函產生器", "預期產出": "活動邀請函", "次分類": "內部溝通", "標籤": "產生器", "框架": "-"},
    "thankyou": {"功能說明": "感謝函產生器", "預期產出": "感謝函範本", "次分類": "內部溝通", "標籤": "產生器", "框架": "-"},

    # === 學習系統 ===
    "learning": {"功能說明": "學習成效追蹤器", "預期產出": "學習成效分析報告", "次分類": "學習優化", "標籤": "追蹤器", "框架": "-"},
    "optimize": {"功能說明": "指令優化建議器", "預期產出": "指令使用優化建議", "次分類": "系統設定", "標籤": "建議器", "框架": "-"},
    "suggest": {"功能說明": "智慧推薦產生器", "預期產出": "相關指令推薦", "次分類": "學習優化", "標籤": "產生器", "框架": "-"},
    "promptlib": {"功能說明": "提示詞庫管理器", "預期產出": "Prompt範本庫", "次分類": "系統設定", "標籤": "管理器", "框架": "-"},
    "evaluate": {"功能說明": "成效評估產生器", "預期產出": "指令成效評估報告", "次分類": "學習優化", "標籤": "產生器", "框架": "-"},
    "knowledge": {"功能說明": "知識庫更新器", "預期產出": "知識庫更新建議", "次分類": "系統設定", "標籤": "更新器", "框架": "-"},
    "learn": {"功能說明": "學習記錄產生器", "預期產出": "學習歷程記錄", "次分類": "學習優化", "標籤": "產生器", "框架": "-"},
    "newprompt": {"功能說明": "新指令建立器", "預期產出": "自訂指令範本", "次分類": "系統設定", "標籤": "建立器", "框架": "-"},
    "promptanalyze": {"功能說明": "指令分析器", "預期產出": "指令使用分析報告", "次分類": "學習優化", "標籤": "分析器", "框架": "-"},
    "promptlog": {"功能說明": "指令日誌產生器", "預期產出": "指令使用日誌", "次分類": "系統設定", "標籤": "產生器", "框架": "-"},
    "improve": {"功能說明": "改善建議產生器", "預期產出": "流程/內容改善建議", "次分類": "學習優化", "標籤": "產生器", "框架": "-"},

    # === 數據分析補充 ===
    "adreport": {"功能說明": "廣告成效報告產生器", "預期產出": "廣告投放成效報告", "次分類": "績效分析", "標籤": "產生器", "框架": "-"},
    "clv": {"功能說明": "顧客終身價值分析器", "預期產出": "CLV分析報告", "次分類": "顧客分析", "標籤": "分析器", "框架": "CLV"},
    "costbenefit": {"功能說明": "成本效益分析器", "預期產出": "成本效益分析報告", "次分類": "財務分析", "標籤": "分析器", "框架": "CBA"},
    "crtest": {"功能說明": "轉換率測試規劃器", "預期產出": "CR測試實驗方案", "次分類": "轉換優化", "標籤": "規劃器", "框架": "A/B Testing"},
    "funnelopt": {"功能說明": "漏斗優化分析器", "預期產出": "漏斗各階段優化建議", "次分類": "數據分析", "標籤": "分析器", "框架": "AARRR"},
    "growthtest": {"功能說明": "成長實驗規劃器", "預期產出": "成長駭客實驗方案", "次分類": "數據分析", "標籤": "規劃器", "框架": "Growth Hacking"},
    "retention": {"功能說明": "留存分析產生器", "預期產出": "顧客留存分析報告", "次分類": "顧客分析", "標籤": "分析器", "框架": "Retention"},
    "roi": {"功能說明": "ROI投資報酬分析器", "預期產出": "投資報酬率分析報告", "次分類": "財務分析", "標籤": "分析器", "框架": "ROI"},
    "segment": {"功能說明": "市場區隔分析器", "預期產出": "市場區隔分析報告", "次分類": "市場分析", "標籤": "分析器", "框架": "STP"},
    "utmtrack": {"功能說明": "UTM追蹤規劃器", "預期產出": "UTM參數設計方案", "次分類": "數據分析", "標籤": "規劃器", "框架": "UTM"},

    # === 專案管理補充 ===
    "bcg": {"功能說明": "BCG矩陣分析器", "預期產出": "BCG產品組合分析", "次分類": "策略規劃", "標籤": "分析器", "框架": "BCG Matrix"},
    "bsc": {"功能說明": "平衡計分卡產生器", "預期產出": "BSC策略地圖", "次分類": "策略規劃", "標籤": "產生器", "框架": "BSC"},
    "decision": {"功能說明": "決策分析產生器", "預期產出": "決策分析矩陣", "次分類": "策略規劃", "標籤": "分析器", "框架": "Decision Matrix"},
    "delegation": {"功能說明": "授權委派產生器", "預期產出": "工作授權規劃", "次分類": "資源管理", "標籤": "產生器", "框架": "-"},
    "dependency": {"功能說明": "相依性分析器", "預期產出": "任務相依性圖表", "次分類": "進度管理", "標籤": "分析器", "框架": "-"},
    "escalate": {"功能說明": "問題升級流程產生器", "預期產出": "問題升級SOP", "次分類": "風險管理", "標籤": "產生器", "框架": "-"},
    "kickoff": {"功能說明": "專案啟動會議產生器", "預期產出": "Kickoff會議議程", "次分類": "會議管理", "標籤": "產生器", "框架": "-"},
    "kpi": {"功能說明": "KPI指標設定器", "預期產出": "關鍵績效指標設定", "次分類": "績效管理", "標籤": "設定器", "框架": "KPI"},
    "milestone": {"功能說明": "里程碑規劃器", "預期產出": "專案里程碑規劃", "次分類": "進度管理", "標籤": "規劃器", "框架": "-"},
    "postmortem": {"功能說明": "專案復盤分析器", "預期產出": "專案復盤報告", "次分類": "專案規劃", "標籤": "分析器", "框架": "Post-mortem"},
    "projectreview": {"功能說明": "專案審查產生器", "預期產出": "專案審查報告", "次分類": "專案規劃", "標籤": "產生器", "框架": "-"},
    "resource": {"功能說明": "資源配置規劃器", "預期產出": "資源配置計畫", "次分類": "資源管理", "標籤": "規劃器", "框架": "-"},
    "scope": {"功能說明": "專案範疇產生器", "預期產出": "專案範疇說明書", "次分類": "專案規劃", "標籤": "產生器", "框架": "Scope"},
    "stakeholder": {"功能說明": "利害關係人分析器", "預期產出": "利害關係人分析圖", "次分類": "專案規劃", "標籤": "分析器", "框架": "Stakeholder Map"},
    "status": {"功能說明": "進度狀態報告產生器", "預期產出": "專案進度報告", "次分類": "進度管理", "標籤": "產生器", "框架": "-"},
    "timeline": {"功能說明": "時程表產生器", "預期產出": "專案時程表", "次分類": "進度管理", "標籤": "產生器", "框架": "Timeline"},
    "wbs": {"功能說明": "WBS工作分解產生器", "預期產出": "工作分解結構圖", "次分類": "專案規劃", "標籤": "產生器", "框架": "WBS"},

    # === 經營管理補充 ===
    "culture": {"功能說明": "企業文化產生器", "預期產出": "企業文化建構方案", "次分類": "人力資源", "標籤": "產生器", "框架": "-"},
    "jobdesc": {"功能說明": "職位說明書產生器", "預期產出": "JD職位說明書", "次分類": "人力資源", "標籤": "產生器", "框架": "-"},
    "orgchart": {"功能說明": "組織架構圖產生器", "預期產出": "組織架構圖", "次分類": "人力資源", "標籤": "產生器", "框架": "-"},
    "policy": {"功能說明": "政策規範產生器", "預期產出": "內部政策規範", "次分類": "門市管理", "標籤": "產生器", "框架": "-"},
    "succession": {"功能說明": "接班計畫產生器", "預期產出": "人才接班計畫", "次分類": "人力資源", "標籤": "產生器", "框架": "-"},
    "value": {"功能說明": "企業價值觀產生器", "預期產出": "企業核心價值", "次分類": "品牌策略", "標籤": "產生器", "框架": "-"},

    # === 客戶經營補充 ===
    "apology": {"功能說明": "道歉聲明產生器", "預期產出": "公關道歉聲明", "次分類": "客訴處理", "標籤": "產生器", "框架": "-"},
    "followup": {"功能說明": "跟進追蹤產生器", "預期產出": "客戶跟進計畫", "次分類": "CRM", "標籤": "產生器", "框架": "-"},
    "loyalty": {"功能說明": "忠誠度計畫產生器", "預期產出": "忠誠度獎勵方案", "次分類": "會員經營", "標籤": "產生器", "框架": "Loyalty"},
    "reward": {"功能說明": "獎勵機制產生器", "預期產出": "會員獎勵制度設計", "次分類": "會員經營", "標籤": "產生器", "框架": "-"},
    "vip": {"功能說明": "VIP服務產生器", "預期產出": "VIP會員服務方案", "次分類": "會員經營", "標籤": "產生器", "框架": "-"},
    "winback": {"功能說明": "流失客戶喚回產生器", "預期產出": "客戶喚回策略", "次分類": "CRM", "標籤": "產生器", "框架": "Win-back"},

    # === 數位行銷補充 ===
    "cta": {"功能說明": "CTA行動呼籲產生器", "預期產出": "高轉換CTA文案", "次分類": "轉換優化", "標籤": "產生器", "框架": "-"},
    "emailcampaign": {"功能說明": "Email行銷活動產生器", "預期產出": "EDM行銷活動規劃", "次分類": "數位廣告", "標籤": "產生器", "框架": "Email Marketing"},
    "popup": {"功能說明": "彈窗設計產生器", "預期產出": "網站彈窗設計規劃", "次分類": "轉換優化", "標籤": "產生器", "框架": "-"},

    # === 供應商管理補充 ===
    "receiving": {"功能說明": "驗收檢核產生器", "預期產出": "驗收檢核清單", "次分類": "品質管理", "標籤": "檢核表", "框架": "-"},
    "vendorscore": {"功能說明": "供應商評分卡產生器", "預期產出": "供應商評分表", "次分類": "供應商管理", "標籤": "產生器", "框架": "Scorecard"},

    # === 加盟展覽補充 ===
    "eventbudget": {"功能說明": "活動預算產生器", "預期產出": "活動預算規劃表", "次分類": "展覽活動", "標籤": "產生器", "框架": "-"},
    "eventchecklist": {"功能說明": "活動檢核表產生器", "預期產出": "活動執行檢核清單", "次分類": "展覽活動", "標籤": "檢核表", "框架": "-"},
    "marketday": {"功能說明": "市集活動產生器", "預期產出": "市集活動企劃", "次分類": "展覽活動", "標籤": "產生器", "框架": "-"},
    "roadshow": {"功能說明": "路演活動產生器", "預期產出": "路演活動企劃", "次分類": "展覽活動", "標籤": "產生器", "框架": "-"},
    "sponsorship": {"功能說明": "贊助提案產生器", "預期產出": "贊助合作提案書", "次分類": "商業開發", "標籤": "產生器", "框架": "-"},

    # === IP授權補充 ===
    "ipaudit": {"功能說明": "IP授權稽核產生器", "預期產出": "IP使用稽核報告", "次分類": "授權管理", "標籤": "產生器", "框架": "-"},
    "ipguideline": {"功能說明": "IP使用規範產生器", "預期產出": "IP使用規範指南", "次分類": "授權管理", "標籤": "指南", "框架": "-"},
    "ipreport": {"功能說明": "IP合作報告產生器", "預期產出": "IP合作成效報告", "次分類": "授權管理", "標籤": "產生器", "框架": "-"},

    # === 視覺設計補充 ===
    "buffer": {"功能說明": "Buffer排程產生器", "預期產出": "社群排程規劃", "次分類": "社群經營", "標籤": "排程器", "框架": "-"},
    "colorpalette": {"功能說明": "色票產生器", "預期產出": "品牌色票配置", "次分類": "品牌視覺", "標籤": "產生器", "框架": "-"},
    "mockup": {"功能說明": "Mockup規劃產生器", "預期產出": "視覺稿規劃建議", "次分類": "素材製作", "標籤": "產生器", "框架": "-"},
    "typography": {"功能說明": "字型規範產生器", "預期產出": "字型使用規範", "次分類": "品牌視覺", "標籤": "指南", "框架": "Typography"},
}

def get_all_commands():
    """取得所有指令檔案"""
    commands = []
    for filename in os.listdir(COMMANDS_DIR):
        if filename.endswith('.md'):
            commands.append(filename[:-3])  # 移除 .md
    return sorted(commands)

def parse_command_file(cmd_name):
    """解析單一指令檔案"""
    filepath = os.path.join(COMMANDS_DIR, f"{cmd_name}.md")

    if not os.path.exists(filepath):
        return None

    with open(filepath, 'r', encoding='utf-8') as f:
        content = f.read()

    # 提取標題
    title_match = re.search(r'^#\s+(.+)', content, re.MULTILINE)
    title = title_match.group(1) if title_match else cmd_name

    # 提取適用職務
    role_match = re.search(r'適用職務[：:]\s*(.+)', content)
    roles = role_match.group(1).strip() if role_match else "-"

    # 提取優先級
    priority_match = re.search(r'優先級[：:]\s*(⭐+)', content)
    priority = priority_match.group(1) if priority_match else "⭐⭐"

    return {
        "title": title,
        "roles": roles,
        "priority": priority,
        "content": content
    }

def get_command_details(cmd_name, parsed_data):
    """取得指令詳細資料"""
    # 優先使用預定義資料
    if cmd_name in COMMAND_DETAILS:
        details = COMMAND_DETAILS[cmd_name].copy()
    else:
        # 根據檔案內容推測
        title = parsed_data.get("title", cmd_name) if parsed_data else cmd_name
        details = {
            "功能說明": title,
            "預期產出": title.replace("產生器", "").replace("分析器", "分析報告"),
            "次分類": "其他",
            "標籤": "產生器" if "產生" in title else "分析器" if "分析" in title else "工具",
            "框架": "-"
        }

    # 取得主分類
    sub_cat = details.get("次分類", "其他")
    main_cat = CATEGORY_MAPPING.get(sub_cat, "其他")
    details["主分類"] = main_cat

    # 加入解析的資料
    if parsed_data:
        details["適用"] = parsed_data.get("roles", "-")
        details["優先級"] = parsed_data.get("priority", "⭐⭐")
    else:
        details["適用"] = "-"
        details["優先級"] = "⭐⭐"

    return details

def main():
    """主程式"""
    commands = get_all_commands()
    all_data = []

    # 分類計數
    category_count = {}

    for cmd in commands:
        parsed = parse_command_file(cmd)
        details = get_command_details(cmd, parsed)

        entry = {
            "指令": f"/{cmd}",
            "功能說明": details["功能說明"],
            "預期產出": details["預期產出"],
            "主分類": details["主分類"],
            "次分類": details["次分類"],
            "標籤": details["標籤"],
            "框架": details["框架"],
            "適用": details["適用"],
            "優先級": details["優先級"]
        }
        all_data.append(entry)

        # 計數
        cat = details["主分類"]
        category_count[cat] = category_count.get(cat, 0) + 1

    # 按主分類排序
    category_order = [
        "行銷企劃", "數位行銷", "數據分析", "視覺設計",
        "專案管理", "經營管理", "客戶經營", "供應商管理",
        "加盟與展覽", "IP授權專項", "溝通協作", "學習系統", "其他"
    ]

    def sort_key(item):
        cat = item["主分類"]
        try:
            return (category_order.index(cat), item["指令"])
        except ValueError:
            return (999, item["指令"])

    all_data.sort(key=sort_key)

    # 儲存JSON
    with open("/home/user/roaddy/commands_data_v2.json", 'w', encoding='utf-8') as f:
        json.dump(all_data, f, ensure_ascii=False, indent=2)

    print(f"總計: {len(all_data)} 個指令")
    print("\n分類統計:")
    for cat in category_order:
        if cat in category_count:
            print(f"  {cat}: {category_count[cat]}")

    return all_data, category_count

if __name__ == "__main__":
    main()
